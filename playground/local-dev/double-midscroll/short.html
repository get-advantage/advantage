<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }
  </style>
  <script type="module">
    import { AdvantageCreativeMessenger } from "/src/advantage/messaging/creative-side";
    import { AdvantageMessageAction, AdvantageFormatName } from "/src/types";
    import logger from "/src/utils/logging";

    // Enable debug mode dynamically
    logger.enableDebugMode();

    async function main() {
      function onWaypointTrigger(waypointId, isIntersecting) {
        logger.debug(`Waypoint ${waypointId} is ${isIntersecting ? 'visible' : 'not visible'}`);
      }

      const advantageMessenger = new AdvantageCreativeMessenger();
      window.advantageMessenger = advantageMessenger;
      const session = await advantageMessenger.startSession();

      if (session) {
        const response = await advantageMessenger.sendMessage({
          action: AdvantageMessageAction.REQUEST_FORMAT,
          format: AdvantageFormatName.DoubleMidscroll,
          backgroundAdURL: "http://localhost:5173/playground/local-dev/double-midscroll/tall.html",
        });
        if (response?.action === AdvantageMessageAction.FORMAT_CONFIRMED) {
          logger.info("Double Midscroll format is confirmed, starting ad");
          document.body.style.opacity = "1";

          advantageMessenger.listenToWaypoints(onWaypointTrigger);
        }
      }
    }
    main();

  </script>
</head>

<body style="opacity: 0; transition: opacity 1s ease-in;">
  <h1>Foreground</h1>
  <!-- <picture style="
    display: block;
    height: 100%;
    width: 100%;
">
    <source srcset="./safearea-midscroll-landscape.png" media="(orientation: landscape)">
    <source srcset="./safearea-midscroll-portrait.png" media="(orientation: portrait)">
    <img alt="banner image" src="./safearea-midscroll-portrait.png"
      style="width: 100%; height: 100%; object-fit: cover; object-position: center center;">
  </picture> -->

</body>

</html>